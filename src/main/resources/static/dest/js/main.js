"use strict";$(document).ready(pageReady);var REG={email:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,pswd:/^[a-zA-Z0-9!@#$%^&*]{6,16}$/};function pageReady(){var a=$("#emailIn"),i=$("#pswdIn"),n=$("#submitIn");a.on("blur",checkValue(matchEmail)),a.on("focus",rmValidationClass),i.on("blur",checkValue(matchLength)),i.on("focus",rmValidationClass),n.on("click",function(n){n.preventDefault(),$.ajax({type:"POST",url:"http://127.0.0.1:3000/signin",data:JSON.stringify({email:a.val(),pswd:i.val()}),dataType:"json",contentType:"application/json",success:function(n){console.log(n)},error:function(n){console.error(n)}})});var s=$("#emailUp"),t=$("#nameUp"),o=$("#pswdUp"),e=($("#enPwsdUp"),$("#valCode")),l=$("#sendValCode"),c=$("#submitUp");s.on("blur",function(){$.ajax({type:"POST",url:"/isExist",data:JSON.stringify({emila:s.val()}),dataType:"json",contentType:"application/json",success:function(n){console.log(n)},error:function(n){console.error(n)}})}),s.on("focus",rmValidationClass),t.on("blur",checkValue(isNotEmptyForm)),t.on("focus",rmValidationClass),o.on("blur",checkValue(matchPswd)),l.on("click",function(n){n.preventDefault(),$.ajax({type:"GET",url:"http://127.0.0.1:3000/api/getValCode",dataType:"json",success:function(a){console.log(a),a=JSON.parse(a).valCode,e.on("blur",function(){var n=e.val();a===n?$(this).addClass("is-valid"):$(this).addClass("is-invalid")}),dealEmailCountingDown(l,function(n){n.addClass("disabled").attr("disabled","true")},function(n){n.removeClass("disabled").removeAttr("disabled")}),e.on("focus",function(){e.hasClass(".is-valid")&&e.removeClass(".is-valid"),e.hasClass("is-invalid")&&e.removeClass(".is-invalid")})},error:function(n){console.error(n)}})}),c.on("click",function(n){n.preventDefault(),$.ajax({type:"POST",url:"http://127.0.0.1:3000/signup",data:JSON.stringify({email:s.val(),name:t.val(),pswd:o.val()}),dataType:"json",contentType:"application/json",success:function(n){console.log(n)},error:function(n){console.error(n)}})})}function rmValidationClass(){$(this).hasClass(".is-valid")&&$(this).removeClass(".is-valid"),$(this).hasClass("is-invalid")&&($(this).removeClass(".is-invalid"),$(this.nextElementSibling).css({display:"none"}))}function addValidationClass(n){}function checkValue(a){return function(){var n=$(this).val();a(n)?$(this).addClass("is-valid"):$(this).addClass("is-invalid")}}function matchEmail(n){return n.split(/\s*, \s*/g).every(function(n){return REG.email.test(n)})}function matchLength(n,a,i){return a=a||6,i=i||16,n.length>=a&&n.length<=i}function isNotEmptyForm(n){return 0!==n.length}function matchPswd(n){return REG.pswd.test(n)}function dealEmailCountingDown(n,a,i){n=n instanceof $?n:$(n),a&&a instanceof Function&&a(n),countingDown(n,60,i)()}function countingDown(a,i,s){return function(){i-=1,$(a).text(i+"秒后重新获取验证码");var n=null;0!==i?n=setTimeout(countingDown($(a),i,s),1e3):(clearTimeout(n),$(a).text("获取邮箱验证码"),s&&s instanceof Function&&s(a))}}