"use strict";$(document).ready(pageReady);var REG={email:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,pswd:/^[a-zA-Z0-9!@#$%^&*]{6,16}$/},server="";function pageReady(){var n=$("#emailIn"),a=$("#pswdIn"),i=($("#submitIn"),$("#formIn"));n.on("blur",checkValue(matchEmail)),n.on("focus",rmValidationClass),a.on("blur",checkValue(matchLength)),a.on("focus",rmValidationClass),i.on("submit",function(n){n.preventDefault(),$.ajax({type:"POST",url:"/api/login",contentType:"application/x-www-form-urlencoded",data:i.serialize(),success:function(n){console.log(n)},error:function(n){console.error(n)}})});var s=$("#emailUp"),e=$("#nameUp"),t=$("#pswdUp"),o=($("#enPwsdUp"),$("#valCode")),l=$("#sendValCode"),r=$("#submitUp");s.on("blur",function(){$.ajax({type:"POST",url:server+"/api/isExist",data:JSON.stringify({emila:s.val()}),dataType:"json",contentType:"application/json",success:function(n){console.log(n)},error:function(n){console.error(n)}})}),s.on("focus",rmValidationClass),e.on("blur",checkValue(isNotEmptyForm)),e.on("focus",rmValidationClass),t.on("blur",checkValue(matchPswd)),l.on("click",function(n){n.preventDefault(),$.ajax({type:"GET",url:server+"/api/getValCode",dataType:"json",success:function(a){console.log(a),a=JSON.parse(a).valCode,o.on("blur",function(){var n=o.val();a===n?$(this).addClass("is-valid"):$(this).addClass("is-invalid")}),dealEmailCountingDown(l,function(n){n.addClass("disabled").attr("disabled","true")},function(n){n.removeClass("disabled").removeAttr("disabled")}),o.on("focus",function(){o.hasClass(".is-valid")&&o.removeClass(".is-valid"),o.hasClass("is-invalid")&&o.removeClass(".is-invalid")})},error:function(n){console.error(n)}})}),r.on("click",function(n){n.preventDefault(),$.ajax({type:"POST",url:server+"/api/signup",data:JSON.stringify({email:s.val(),name:e.val(),pswd:t.val()}),dataType:"json",contentType:"application/json",success:function(n){console.log(n)},error:function(n){console.error(n)}})})}function rmValidationClass(){$(this).hasClass(".is-valid")&&$(this).removeClass(".is-valid"),$(this).hasClass("is-invalid")&&($(this).removeClass(".is-invalid"),$(this.nextElementSibling).css({display:"none"}))}function addValidationClass(n){}function checkValue(a){return function(){var n=$(this).val();a(n)?$(this).addClass("is-valid"):$(this).addClass("is-invalid")}}function matchEmail(n){return n.split(/\s*, \s*/g).every(function(n){return REG.email.test(n)})}function matchLength(n,a,i){return a=a||6,i=i||16,n.length>=a&&n.length<=i}function isNotEmptyForm(n){return 0!==n.length}function matchPswd(n){return REG.pswd.test(n)}function dealEmailCountingDown(n,a,i){n=n instanceof $?n:$(n),a&&a instanceof Function&&a(n),countingDown(n,60,i)()}function countingDown(a,i,s){return function(){i-=1,$(a).text(i+"秒后重新获取验证码");var n=null;0!==i?n=setTimeout(countingDown($(a),i,s),1e3):(clearTimeout(n),$(a).text("获取邮箱验证码"),s&&s instanceof Function&&s(a))}}